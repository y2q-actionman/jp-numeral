(in-package :cl-user)

(ql:quickload :babel)


(defpackage kansuji
  (:use :cl :babel))

(in-package :kansuji)


(DEFPARAMETER *KANSUJI-DECIMAL-OCTETS-VECTOR*
    #(#(#1=#(227 128 135) #1# #(233 155 182) NIL)
      #(#(228 184 128) #(229 163 177) #(229 163 185) NIL)
      #(#(228 186 140) #(229 188 144) #(232 178 179) NIL)
      #(#(228 184 137) #(229 143 130) #(229 143 131) NIL)
      #(#2=#(229 155 155) #2# #(232 130 134) NIL)
      #(#3=#(228 186 148) #3# #(228 188 141) NIL)
      #(#4=#(229 133 173) #4# #(233 153 184) NIL)
      #(#5=#(228 184 131) #5# #(230 159 146) NIL)
      #(#6=#(229 133 171) #6# #(230 141 140) NIL)
      #(#7=#(228 185 157) #7# #(231 142 150) NIL))
  "A vector of (<normal-octets> <financial-octets> <old-octets> <alternative-in-BMP-of-Unicode>)")

(DEFPARAMETER *KANSUJI-POWER-OCTETS-ALIST*
    #((1 . #(#(229 141 129) #1=#(230 139 190) #1# NIL))
      (2 . #(#2=#(231 153 190) #2# #(228 189 176) NIL))
      (3 . #(#3=#(229 141 131) #3# #(228 187 159) NIL))
      (4 . #(#4=#(228 184 135) #4# #(232 144 172) NIL))
      (8 . #(#5=#(229 132 132) #5# #5# NIL))
      (12 . #(#6=#(229 133 134) #6# #6# NIL))
      (16 . #(#7=#(228 186 172) #7# #7# NIL))
      (20 . #(#8=#(229 158 147) #8# #8# NIL))
      (24
       . #(#9=#(237 161 149 237 189 177) #9# #(231 167 173)
           #(231 167 173)))
      (28 . #(#10=#(231 169 163) #10# #10# NIL))
      (32 . #(#11=#(230 186 157) #11# #11# NIL))
      (36 . #(#12=#(230 190 151) #12# #12# NIL))
      (40 . #(#13=#(230 173 163) #13# #13# NIL))
      (44 . #(#14=#(232 188 137) #14# #14# NIL))
      (48 . #(#15=#(230 165 181) #15# #15# NIL))
      (52
       . #(#16=#(230 129 146 230 178 179 230 178 153) #16# #16# NIL))
      (56
       . #(#17=#(233 152 191 229 131 167 231 165 135) #17# #17# NIL))
      (60
       . #(#18=#(233 130 163 231 148 177 228 187 150) #18# #18# NIL))
      (64
       . #(#19=#(228 184 141 229 143 175 230 128 157 232 173 176) #19#
           #19# NIL))
      (68
       . #(#20=#(231 132 161 233 135 143 229 164 167 230 149 176) #20#
           #20# NIL))
      (-1 . #(#21=#(229 136 134) #21# #21# NIL))
      (-2 . #(#22=#(229 142 152) #22# #(233 135 144) NIL))
      (-3 . #(#23=#(230 175 155) #23# #(230 175 171) NIL))
      (-4 . #(#24=#(231 179 184) #24# #(231 181 178) NIL))
      (-5 . #(#25=#(229 191 189) #25# #25# NIL))
      (-6 . #(#26=#(229 190 174) #26# #26# NIL))
      (-7 . #(#27=#(231 185 138) #27# #27# NIL))
      (-8 . #(#28=#(230 178 153) #28# #28# NIL))
      (-9 . #(#29=#(229 161 181) #29# #29# NIL))
      (-10 . #(#30=#(229 159 131) #30# #30# NIL))
      (-11 . #(#31=#(230 184 186) #31# #31# NIL))
      (-12 . #(#32=#(230 188 160) #32# #32# NIL))
      (-13 . #(#33=#(230 168 161 231 179 138) #33# #33# NIL))
      (-14 . #(#34=#(233 128 161 229 183 161) #34# #34# NIL))
      (-15 . #(#35=#(233 160 136 232 135 190) #35# #35# NIL))
      (-16 . #(#36=#(231 158 172 230 129 175) #36# #36# NIL))
      (-17 . #(#37=#(229 188 190 230 140 135) #37# #37# NIL))
      (-18 . #(#38=#(229 136 185 233 130 163) #38# #38# NIL))
      (-19 . #(#39=#(229 133 173 229 190 179) #39# #39# NIL))
      (-20 . #(#40=#(232 153 154 231 169 186) #40# #40# NIL))
      (-21 . #(#41=#(230 184 133 230 181 132) #41# #41# NIL)))
  "An alist of (<power> . (<normal-octets> <financial-octets> <old-octets> <alternative-in-BMP-of-Unicode>))")


(defun usage-to-index (sym)
  (ecase sym
    (:normal 0)
    (:financial 1)
    (:old 2)))

(defun get-kansuji-decimal (n usage)
  (assert (<= 0 n 9))
  (let ((entry (aref *kansuji-decimal-octets-vector* n)))
    ;; TODO: if BMP is requested..
    (aref entry (usage-to-index usage))))
     


(defun print-kansuji (stream object &optional colon-p at-sign-p)
  ;; colon => financial
  ;; at-sign => old japanse
  nil)
